# KuCoin Futures API Documentation

## Overview

KuCoin Futures (KuMEX) API documentation for building the futures connector.

**Base URLs:**
- **Futures REST API:** `https://api-futures.kucoin.com`
- **Spot REST API:** `https://api.kucoin.com`
- **WebSocket:** Dynamic URL obtained from `/api/v1/bullet-public` or `/api/v1/bullet-private`

## Authentication

### API Key Components
1. **API Key** - Generated by KuCoin
2. **Secret** - Generated by KuCoin  
3. **Passphrase** - User-defined when creating API key

### Required Headers
```
KC-API-KEY: <API_KEY>
KC-API-SIGN: <SIGNATURE>
KC-API-TIMESTAMP: <TIMESTAMP_MS>
KC-API-PASSPHRASE: <ENCRYPTED_PASSPHRASE>
KC-API-KEY-VERSION: 2
Content-Type: application/json
```

### Signature Generation
1. Create prehash string: `{timestamp}{method}{endpoint}{body}`
2. Sign with HMAC-SHA256 using API Secret
3. Base64 encode the signature

### Passphrase Encryption
1. Sign passphrase with HMAC-SHA256 using API Secret
2. Base64 encode result

**Signature Code Example (Go):**
```go
func sign(secret, timestamp, method, endpoint, body string) string {
    message := timestamp + method + endpoint + body
    h := hmac.New(sha256.New, []byte(secret))
    h.Write([]byte(message))
    return base64.StdEncoding.EncodeToString(h.Sum(nil))
}

func signPassphrase(secret, passphrase string) string {
    h := hmac.New(sha256.New, []byte(secret))
    h.Write([]byte(passphrase))
    return base64.StdEncoding.EncodeToString(h.Sum(nil))
}
```

---

## REST API Endpoints

### Market Data (Public)

#### Get All Contracts
```
GET /api/v1/contracts/active
Rate Limit Weight: 3
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "symbol": "XBTUSDTM",
            "rootSymbol": "USDT",
            "type": "FFWCSX",
            "baseCurrency": "XBT",
            "quoteCurrency": "USDT", 
            "settleCurrency": "USDT",
            "maxOrderQty": 1000000,
            "maxPrice": 1000000.0,
            "lotSize": 1,
            "tickSize": 0.1,
            "indexPriceTickSize": 0.01,
            "multiplier": 0.001,
            "initialMargin": 0.01,
            "maintainMargin": 0.005,
            "maxRiskLimit": 500000,
            "minRiskLimit": 500000,
            "riskStep": 250000,
            "makerFeeRate": 0.0002,
            "takerFeeRate": 0.0006,
            "takerFixFee": 0.0,
            "makerFixFee": 0.0,
            "isDeleverage": true,
            "isQuanto": false,
            "isInverse": false,
            "markMethod": "FairPrice",
            "fairMethod": "FundingRate",
            "fundingBaseSymbol": ".XBTINT8H",
            "fundingQuoteSymbol": ".USDTINT8H",
            "fundingRateSymbol": ".XBTUSDTMFPI8H",
            "indexSymbol": ".KXBTUSDT",
            "settlementSymbol": "",
            "status": "Open",
            "fundingFeeRate": 0.0001,
            "predictedFundingFeeRate": 0.0001,
            "openInterest": "5191275",
            "turnoverOf24h": 2361994501.712,
            "volumeOf24h": 23259.0,
            "markPrice": 101509.41,
            "indexPrice": 101507.56,
            "lastTradePrice": 101514.8,
            "nextFundingRateTime": 14208629,
            "maxLeverage": 100,
            "lowPrice": 96600.0,
            "highPrice": 103500.0
        }
    ]
}
```

#### Get Ticker
```
GET /api/v1/ticker?symbol={symbol}
Rate Limit Weight: 2
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "sequence": 1001,
        "symbol": "XBTUSDTM",
        "side": "buy",
        "size": 10,
        "price": "101500.5",
        "bestBidSize": 500,
        "bestBidPrice": "101500.0",
        "bestAskSize": 400,
        "bestAskPrice": "101500.5",
        "tradeId": "5c52e11203aa677f33e493fb",
        "ts": 1702296000000
    }
}
```

#### Get All Tickers
```
GET /api/v1/allTickers
Rate Limit Weight: 5
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "sequence": 1001,
            "symbol": "XBTUSDTM",
            "side": "buy",
            "size": 10,
            "tradeId": "5c52e11203aa677f33e493fb",
            "price": "101500.5",
            "bestBidPrice": "101500.0",
            "bestBidSize": 500,
            "bestAskPrice": "101500.5",
            "bestAskSize": 400,
            "ts": 1702296000000
        }
    ]
}
```

#### Get Full Order Book (Level 2)
```
GET /api/v1/level2/snapshot?symbol={symbol}
Rate Limit Weight: 3
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "symbol": "XBTUSDTM",
        "sequence": 100,
        "asks": [
            [101500.5, 400],
            [101501.0, 300]
        ],
        "bids": [
            [101500.0, 500],
            [101499.5, 600]
        ],
        "ts": 1702296000000
    }
}
```

#### Get Part Order Book (Level 2)
```
GET /api/v1/level2/depth{size}?symbol={symbol}
Sizes: 20, 100
Rate Limit Weight: 5
```

#### Get Klines (Candlesticks)
```
GET /api/v1/kline/query?symbol={symbol}&granularity={granularity}&from={from}&to={to}
Rate Limit Weight: 3
Granularities: 1, 5, 15, 30, 60, 120, 240, 480, 720, 1440, 10080 (minutes)
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        [
            1702296000000,   // timestamp
            "101500.0",      // open
            "101600.0",      // high
            "101400.0",      // low
            "101550.0",      // close
            "1000"           // volume
        ]
    ]
}
```

#### Get Trade History
```
GET /api/v1/trade/history?symbol={symbol}
Rate Limit Weight: 3
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "sequence": 100,
            "tradeId": "5c52e11203aa677f33e493fb",
            "takerOrderId": "5c52e11203aa677f33e493fc",
            "makerOrderId": "5c52e11203aa677f33e493fd",
            "price": "101500.5",
            "size": 10,
            "side": "buy",
            "ts": 1702296000000
        }
    ]
}
```

#### Get Current Funding Rate
```
GET /api/v1/funding-rate/{symbol}/current
Rate Limit Weight: 2
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "symbol": ".XBTUSDTMFPI8H",
        "granularity": 28800000,
        "timePoint": 1748462400000,
        "value": 0.000061,
        "predictedValue": 0.000109,
        "fundingRateCap": 0.003,
        "fundingRateFloor": -0.003,
        "period": 0,
        "fundingTime": 1748491200000
    }
}
```

#### Get Public Funding History
```
GET /api/v1/contract/funding-rates?symbol={symbol}&from={from}&to={to}
Rate Limit Weight: 5
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "symbol": "XBTUSDTM",
            "fundingRate": 0.00021,
            "timepoint": 1702296000000
        }
    ]
}
```

#### Get Mark Price
```
GET /api/v1/mark-price/{symbol}/current
Rate Limit Weight: 2
```

#### Get Service Status
```
GET /api/v1/status
Rate Limit Weight: 1
```

---

### Orders (Private)

#### Place Order
```
POST /api/v1/orders
Rate Limit Weight: 2
Permission: Futures
```

**Request:**
```json
{
    "clientOid": "5c52e11203aa677f33e493fb",
    "symbol": "XBTUSDTM",
    "marginMode": "ISOLATED",
    "leverage": 3,
    "positionSide": "BOTH",
    "side": "buy",
    "type": "limit",
    "size": 1,
    "price": "100000",
    "timeInForce": "GTC",
    "reduceOnly": false,
    "remark": "order_remarks"
}
```

**Parameters:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| clientOid | string | Yes | Unique order ID from client |
| symbol | string | Yes | Contract symbol (e.g. XBTUSDTM) |
| side | string | Yes | "buy" or "sell" |
| type | string | Yes | "limit" or "market" |
| size | int | Yes | Order size in lots |
| price | string | No | Required for limit orders |
| leverage | string | No | Leverage multiple |
| marginMode | string | No | "ISOLATED" or "CROSS" |
| positionSide | string | No | "BOTH", "LONG", "SHORT" |
| timeInForce | string | No | "GTC", "IOC", "FOK" |
| reduceOnly | bool | No | Reduce only flag |
| postOnly | bool | No | Post only flag |
| hidden | bool | No | Hidden order |
| iceberg | bool | No | Iceberg order |
| visibleSize | int | No | For iceberg orders |
| stop | string | No | "down" or "up" for stop orders |
| stopPrice | string | No | Stop trigger price |
| stopPriceType | string | No | "TP" (trade price), "IP" (index), "MP" (mark) |

**Response:**
```json
{
    "code": "200000",
    "data": {
        "orderId": "234125150956625920",
        "clientOid": "5c52e11203aa677f33e493fb"
    }
}
```

#### Batch Place Orders
```
POST /api/v1/orders/multi
Rate Limit Weight: 20
Permission: Futures
Max Orders: 20
```

**Request:** Array of order objects (same fields as single order)

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "orderId": "235919387779985408",
            "clientOid": "5c52e11203aa677f33e493fb",
            "symbol": "XBTUSDTM",
            "code": "200000",
            "msg": "success"
        }
    ]
}
```

#### Cancel Order by OrderId
```
DELETE /api/v1/orders/{orderId}
Rate Limit Weight: 1
Permission: Futures
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "cancelledOrderIds": ["235303670076489728"]
    }
}
```

#### Cancel Order by ClientOid
```
DELETE /api/v1/orders/client-order/{clientOid}?symbol={symbol}
Rate Limit Weight: 1
Permission: Futures
```

#### Cancel All Orders
```
DELETE /api/v3/orders?symbol={symbol}
Rate Limit Weight: 10
Permission: Futures
```

#### Cancel All Stop Orders
```
DELETE /api/v1/stopOrders?symbol={symbol}
Rate Limit Weight: 10
Permission: Futures
```

#### Get Order by OrderId
```
GET /api/v1/orders/{orderId}
Rate Limit Weight: 2
Permission: General
```

#### Get Order List
```
GET /api/v1/orders?symbol={symbol}&status={status}&side={side}&type={type}
Rate Limit Weight: 2
Permission: General
Status: "active" or "done"
```

#### Get Recent Closed Orders
```
GET /api/v1/recentDoneOrders?symbol={symbol}
Rate Limit Weight: 2
Permission: General
```

#### Get Trade History (Fills)
```
GET /api/v1/fills?symbol={symbol}&orderId={orderId}&side={side}&type={type}
Rate Limit Weight: 2
Permission: General
```

---

### Positions (Private)

#### Get Position List
```
GET /api/v1/positions?currency={currency}
Rate Limit Weight: 2
Permission: General
```

**Response:**
```json
{
    "code": "200000",
    "data": [
        {
            "id": "500000000001478576",
            "symbol": "XBTUSDTM",
            "autoDeposit": true,
            "crossMode": false,
            "maintMarginReq": 0.004,
            "riskLimit": 500000,
            "realLeverage": 6.0,
            "delevPercentage": 0.05,
            "openingTimestamp": 1759458359537,
            "currentTimestamp": 1759458415086,
            "currentQty": 1,
            "currentCost": 120.0164,
            "currentComm": 0.07200984,
            "unrealisedCost": 120.0164,
            "realisedGrossCost": 0.0,
            "realisedCost": 0.07200984,
            "isOpen": true,
            "markPrice": 120009.57,
            "markValue": 120.00957,
            "posCost": 120.0164,
            "posCross": 0,
            "posInit": 20.0027333373,
            "posComm": 0,
            "posMargin": 20.0027333373,
            "posFunding": 0,
            "posMaint": 0.552044022,
            "maintMargin": 19.9959033373,
            "realisedGrossPnl": 0.0,
            "realisedPnl": -0.07200984,
            "unrealisedPnl": -0.00683,
            "unrealisedPnlPcnt": -0.0001,
            "unrealisedRoePcnt": -0.0003,
            "avgEntryPrice": 120016.4,
            "liquidationPrice": 100475.86,
            "bankruptPrice": 100013.67,
            "settleCurrency": "USDT",
            "isInverse": false,
            "maintainMargin": 0.004,
            "marginMode": "ISOLATED",
            "positionSide": "LONG",
            "leverage": 6.0
        }
    ]
}
```

#### Get Position Details
```
GET /api/v1/position?symbol={symbol}
Rate Limit Weight: 2
Permission: General
```

#### Get Margin Mode
```
GET /api/v2/getMarginMode?symbol={symbol}
Rate Limit Weight: 2
Permission: General
```

#### Switch Margin Mode
```
POST /api/v2/changeMarginMode
Rate Limit Weight: 2
Permission: Futures
```

**Request:**
```json
{
    "symbol": "XBTUSDTM",
    "marginMode": "CROSS"
}
```

#### Get Cross Margin Leverage
```
GET /api/v2/getCrossUserLeverage?symbol={symbol}
Rate Limit Weight: 2
Permission: General
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "symbol": "XBTUSDTM",
        "leverage": "3"
    }
}
```

#### Modify Cross Margin Leverage
```
POST /api/v2/changeCrossUserLeverage
Rate Limit Weight: 2
Permission: Futures
```

#### Add Isolated Margin
```
POST /api/v1/position/margin/deposit-margin
Rate Limit Weight: 2
Permission: Futures
```

#### Remove Isolated Margin
```
POST /api/v1/position/margin/withdraw-margin
Rate Limit Weight: 2
Permission: Futures
```

#### Get Risk Limit Level
```
GET /api/v1/contracts/risk-limit/{symbol}
Rate Limit Weight: 5
```

---

### Account (Private)

#### Get Account Overview
```
GET /api/v1/account-overview?currency={currency}
Rate Limit Weight: 5
Permission: General
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "accountEquity": 99.8999305281,
        "unrealisedPNL": 0,
        "marginBalance": 99.8999305281,
        "positionMargin": 0,
        "orderMargin": 0,
        "frozenFunds": 0,
        "availableBalance": 99.8999305281,
        "currency": "USDT"
    }
}
```

#### Get Trade Fees
```
GET /api/v1/trade-fees?symbol={symbol}
Rate Limit Weight: 2
Permission: General
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "symbol": "XBTUSDTM",
        "takerFeeRate": "0.0006",
        "makerFeeRate": "0.0002"
    }
}
```

---

## WebSocket API

### Connection Setup

#### Get Public Token
```
POST /api/v1/bullet-public
Rate Limit Weight: 10
```

**Response:**
```json
{
    "code": "200000",
    "data": {
        "token": "2neAiuYvAU61ZDXANAGAsiL4...",
        "instanceServers": [
            {
                "endpoint": "wss://ws-api-futures.kucoin.com/",
                "encrypt": true,
                "protocol": "websocket",
                "pingInterval": 18000,
                "pingTimeout": 10000
            }
        ]
    }
}
```

#### Get Private Token
```
POST /api/v1/bullet-private
Rate Limit Weight: 10
Permission: General
```

### WebSocket Connection URL
```
wss://{endpoint}?token={token}&connectId={connectId}
```

### Message Types
- `welcome` - Connection established
- `ping` / `pong` - Heartbeat
- `subscribe` / `unsubscribe` - Channel management
- `ack` - Subscription acknowledgment
- `message` - Data message
- `error` - Error message

### Subscribe Message Format
```json
{
    "id": "1545910660739",
    "type": "subscribe",
    "topic": "/contractMarket/ticker:XBTUSDTM",
    "privateChannel": false,
    "response": true
}
```

### Unsubscribe Message Format
```json
{
    "id": "1545910840805",
    "type": "unsubscribe",
    "topic": "/contractMarket/ticker:XBTUSDTM",
    "privateChannel": false,
    "response": true
}
```

### Ping Message
```json
{
    "id": "1545910590801",
    "type": "ping"
}
```

### Pong Response
```json
{
    "id": "1545910590801",
    "type": "pong"
}
```

---

### Public WebSocket Channels

#### Ticker
**Topic:** `/contractMarket/ticker:{symbol}`

**Push Frequency:** Every 100ms

```json
{
    "type": "message",
    "topic": "/contractMarket/ticker:XBTUSDTM",
    "subject": "ticker",
    "data": {
        "sequence": 1545896668986,
        "symbol": "XBTUSDTM",
        "side": "sell",
        "size": 10,
        "price": "101500.5",
        "bestBidPrice": "101500.0",
        "bestBidSize": 500,
        "bestAskPrice": "101500.5",
        "bestAskSize": 400,
        "tradeId": "5c52e11203aa677f33e493fb",
        "ts": 1702296000000
    }
}
```

#### Level 2 OrderBook (5 depth)
**Topic:** `/contractMarket/level2Depth5:{symbol}`

```json
{
    "type": "message",
    "topic": "/contractMarket/level2Depth5:XBTUSDTM",
    "subject": "level2",
    "data": {
        "sequence": 100,
        "asks": [[101500.5, 400], [101501.0, 300]],
        "bids": [[101500.0, 500], [101499.5, 600]],
        "ts": 1702296000000
    }
}
```

#### Level 2 OrderBook (50 depth)
**Topic:** `/contractMarket/level2Depth50:{symbol}`

#### Level 2 Increment
**Topic:** `/contractMarket/level2:{symbol}`

```json
{
    "type": "message",
    "topic": "/contractMarket/level2:XBTUSDTM",
    "subject": "level2",
    "data": {
        "sequence": 101,
        "change": "101500.5,sell,400",
        "timestamp": 1702296000000
    }
}
```

#### Match Execution Data (Trades)
**Topic:** `/contractMarket/execution:{symbol}`

```json
{
    "type": "message",
    "topic": "/contractMarket/execution:XBTUSDTM",
    "subject": "match",
    "data": {
        "sequence": 100,
        "tradeId": "5c52e11203aa677f33e493fb",
        "takerOrderId": "5c52e11203aa677f33e493fc",
        "makerOrderId": "5c52e11203aa677f33e493fd",
        "price": "101500.5",
        "size": 10,
        "side": "buy",
        "ts": 1702296000000
    }
}
```

#### Instrument Info
**Topic:** `/contract/instrument:{symbol}`

Receives contract updates including funding rate, mark price, index price.

```json
{
    "type": "message",
    "topic": "/contract/instrument:XBTUSDTM",
    "subject": "mark.index.price",
    "data": {
        "granularity": 1000,
        "indexPrice": 101500.00,
        "markPrice": 101502.50,
        "timestamp": 1702296000000
    }
}
```

```json
{
    "type": "message",
    "topic": "/contract/instrument:XBTUSDTM",
    "subject": "funding.rate",
    "data": {
        "granularity": 28800000,
        "fundingRate": 0.0001,
        "timestamp": 1702296000000
    }
}
```

#### Level 3 Full Order Book
**Topic:** `/contractMarket/level3:{symbol}`

For L3 depth data (individual orders).

---

### Private WebSocket Channels

#### Trade Orders
**Topic:** `/contractMarket/tradeOrders`
**Private:** true

```json
{
    "type": "message",
    "topic": "/contractMarket/tradeOrders",
    "subject": "orderChange",
    "data": {
        "orderId": "5c52e11203aa677f33e493fb",
        "symbol": "XBTUSDTM",
        "type": "open",
        "status": "open",
        "matchSize": "",
        "matchPrice": "",
        "orderType": "limit",
        "side": "buy",
        "price": "101500.0",
        "size": "10",
        "remainSize": "10",
        "filledSize": "0",
        "canceledSize": "0",
        "tradeId": "",
        "clientOid": "xxx",
        "orderTime": 1702296000000000000,
        "oldSize": "0",
        "liquidity": "maker",
        "ts": 1702296000000000000
    }
}
```

**Status Types:**
- `open` - Order opened
- `match` - Order partially filled
- `filled` - Order fully filled
- `canceled` - Order canceled
- `update` - Order updated

#### Position Change
**Topic:** `/contract/position:{symbol}`
**Private:** true

```json
{
    "type": "message",
    "topic": "/contract/position:XBTUSDTM",
    "subject": "position.change",
    "data": {
        "realisedGrossPnl": 0.0,
        "symbol": "XBTUSDTM",
        "crossMode": false,
        "liquidationPrice": 100475.86,
        "posLoss": 0,
        "avgEntryPrice": 120016.4,
        "unrealisedPnl": -0.00683,
        "markPrice": 120009.57,
        "posMargin": 20.0027333373,
        "autoDeposit": false,
        "riskLimit": 500000,
        "unrealisedCost": 120.0164,
        "posComm": 0,
        "posMaint": 0.552044022,
        "posCost": 120.0164,
        "maintMarginReq": 0.004,
        "currentQty": 1,
        "currentCost": 120.0164,
        "delevPercentage": 0.05,
        "currentTimestamp": 1702296000000,
        "settleCurrency": "USDT",
        "marginMode": "ISOLATED",
        "positionSide": "LONG"
    }
}
```

#### Account Balance
**Topic:** `/contractAccount/wallet`
**Private:** true

```json
{
    "type": "message",
    "topic": "/contractAccount/wallet",
    "subject": "availableBalance.change",
    "data": {
        "currency": "USDT",
        "holdBalance": "0",
        "availableBalance": "99.8999305281",
        "timestamp": 1702296000000
    }
}
```

---

## Rate Limiting

### Rate Limit Pools
- **Public:** For public endpoints
- **Futures:** For private futures endpoints
- **Spot:** For private spot endpoints

### Rate Limit Rules
- Weight-based deduction system
- Quota resets every 30 seconds
- VIP levels have higher quotas

### Common Rate Limits
| Endpoint Type | Weight |
|--------------|--------|
| Get Contracts | 3 |
| Get Ticker | 2 |
| Get All Tickers | 5 |
| Get OrderBook | 3-5 |
| Get Klines | 3 |
| Place Order | 2 |
| Batch Orders | 20 |
| Cancel Order | 1 |
| Cancel All | 10 |
| Get Positions | 2 |
| WS Token | 10 |

---

## Error Codes

| Code | Description |
|------|-------------|
| 200000 | Success |
| 400001 | Invalid parameter |
| 400002 | System error |
| 400003 | API key not found |
| 400004 | Signature error |
| 400005 | Request timestamp expired |
| 400006 | Access denied |
| 400007 | Rate limit exceeded |
| 400100 | Order creation failed |
| 400200 | Balance insufficient |
| 400300 | Position not found |
| 400500 | Contract not found |

---

## Important Notes

1. **Symbol Format:** Futures symbols end with "M" (e.g., XBTUSDTM, ETHUSDTM)
2. **Size:** Order size is in lots, not coin units. Use `multiplier` to convert.
3. **Timestamps:** All timestamps are in milliseconds unless noted otherwise.
4. **Leverage:** Maximum leverage varies by contract, check `maxLeverage` field.
5. **Margin Modes:** Support both ISOLATED and CROSS margin modes.
6. **Position Modes:** Support BOTH (one-way) and LONG/SHORT (hedge mode).
7. **WebSocket Heartbeat:** Send ping every `pingInterval` ms (usually 18000).
8. **Token Validity:** WebSocket tokens valid for 24 hours.
9. **Order Limits:** Maximum 100 open limit orders and 200 stop orders per contract.
